---
title: 存储器管理
markmap:
  colorFreezeLevel: 3
---

# 存储器管理
## 存储器的层次结构
- 可执行存储器
    - CPU寄存器：寄存器
    - 主存：高速缓存、主存储器、磁盘缓存
- 
    - 辅存：固定磁盘、可移动存储介质

## 程序的装入与链接
### 编译
- 由编译程序(Compiler)对用户源程序进行变异，形成若干个目标模块(Object Module)

### 链接
- 由链接程序(Linker)将编译后形成的一组目标模块以及它们所需要的库函数链接在一起，
形成一个完整的装入模块(可执行文件，Load Module)
- 静态链接方式(Static Linking)
- 装入时动态链接(Load-time Dynamic Linking)
- 运行时动态链接(Run-time Dynamic Linking)

### 装入
- 由装入程序(Loader)将装入模块装入内存
- 绝对装入方式(Absolute Loading Mode)
- 可重定位装入方式(Relocation Loading Mode)
- 动态运行时的装入方式(Dynamic Run-time Loading)

## 连续分配存储管理方式
### 单一连续分配

### 固定分区分配
- 划分分区的方法：分区大小相等、分区大小不等
- 内存分配：通常对分区按大小进行排队，并建立一张分区使用表

### 动态分区分配
- 动态分区分配的数据结构：空闲分区表、空闲分区链
- 动态分区分配的算法
- 分区分配操作：分配内存、回收内存

### 基于动态搜索的分区分配算法
- 首次适应算法(FF)：空闲分区以地址递增次序链接，分配内存时从链首开始查找
- 循环首次适应算法(NF)：FF基础上从上一次查找的位置继续查找
- 最佳适应算法(BF)：空闲分区以容量递增次序链接，分配内存时找到能满足要求的最小空闲分区
- 最坏适应算法(WF)：空闲分区以容量递减次序链接，分配内存时找到能满足要求的最大空闲分区

### 基于索引搜索的动态分区分配算法
- 快速适应算法(quick fit)
    - 空闲分区根据容量大小设立多个链表
    - 优点：查找效率高
    - 缺点：分区归还时合并有效分区的算法比较复杂，系统开销大
- 伙伴系统(buddy system)：无论已分配或空闲分区，其大小均为2的k次幂，对不同大小分区进行分类
- 哈希算法

### 动态可重定位分区分配
- 紧凑：将分区碎片拼接成完整的大分区
- 动态重定位：重定位寄存器
- 动态重定位分区分配算法：在动态分区分配算法的基础上增加了“紧凑”

## 对换（Swapping）
### 对换的引入
- 把内存中暂时不能运行或不用的进程或数据换至外存，并将具备运行条件的进程及数据换入内存

### 对换的类型
- 整体对换（进程对换）：以整个进程为单位进行对换
- 页面（分段）对换：以进程的一个页面或分段为单位进行对换

### 对换空间管理的主要目标
- 文件区：占用磁盘空间大部分。采取离散分配方式。以空间利用率为主要目标，其次才是访问速度
- 对换区：占用磁盘空间小部分。采取连续分配方式，以提高进程对换速度

### 对换区空闲盘块管理的数据结构
- 空闲分区表、空闲分区链

### 对换空间的分配与回收
- 与动态分区方式相似

### 进程的换出
- 选择被换出的进程：优先考虑阻塞、睡眠或低优先级进程，有时考虑内存驻留时间
- 进程换出过程：只能换出非共享程序和数据段。会持续换出可换出进程直到内存中无阻塞进程。

### 进程的换入
- 选择换出时间最久的就绪进程。会持续进行换入直到内存已满或无可换入进程。

## 分页存储管理
### 分页存储管理的基本方法
- 页面和物理块
- 页面大小：太大导致页内碎片增大、太小导致页表过长
- 地址结构：页号、位（偏）移量（页内地址）
- 页表：每一进程都有，记录了页在内存中对应的物理块号

### 地址变换机构
- 页表寄存器PTR(Page-Table Register)
- 快表TLB(Tranditional Look Aside Buffer)

### 访问内存的有效时间

### 两级和多级页表
#### 两级页表
- 外层页表(Outer Page Table)
- 地址结构：外层页号、外层页内偏移量、页内地址
- 外层页表寄存器

#### 多级页表

### 反置页表
- 为每一个物理块设置一个页表项，并将它们按物理块的编号排序，其中内容是页号和其所隶属进程的标识符
- 外部页表：包含了各页在外存的物理位置。当发现所需页面不在内存时才使用

## 分段存储管理方式
### 引入
- 满足用户和程序员：方便编程、信息共享、信息保护、动态增长、动态链接

### 分段系统的基本原理
- 分段地址结构：段号、段内地址
- 段表
- 地址变换机构：段表寄存器、快表

### 信息共享
- 分页系统：保留一份共享信息的备份，在每个共享进程都添加其页表项
- 分段系统：只需在每个共享进程中都添加一个段表项（备份应该需要）
- 可重入代码(Reentrant Code)：纯代码(Pure Code)，是一种允许多个进程同时访问的代码

### 段页式存储管理方式
- 基本原理：将程序分成若干段，再把每个段分成若干页
- 地址结构：段号、段内页号、页内地址
- 地址变换过程
- 段表、页表和快表
