---
title: 多处理机操作系统
markmap:
  colorFreezeLevel: 3
---

# 多处理机操作系统
## 多处理机系统
### 引入
- CPU时钟频率问题
- 增加系统的吞吐量
- 节省投资
- 提高系统可靠性

### 类型
- 紧密耦合MPS和松散耦合MPS
- 对称多处理器系统SMPS和非对称多处理器系统ASMPS

## 多处理机系统的结构
### 统一内存访问UMA
- 基于单总线的SMP结构
- 使用多层总线的SMP结构
- 使用单级交叉开关的系统结构
  - 交叉开关是$N\times N$的阵列，同时只能接通N个结点
  - 每个存储器模块（列）同时只允许一个CPU结点访问，但一个CPU（行）可以访问
  多个存储器结点
  - 交叉开关的成本为$N^2$
- 使用多级交换网络的系统结构

### 非统一内存访问NUMA
- 本地存储器、群内共享存储器、全局共享存储器或其他节点存储器
- CC-NUMA、NC-NUMA
- 远程内存访问由于访问远地内存的延时远远超过本地内存，
当CPU数量增加时，系统性能无法线性增加

## 多处理机操作系统的特征与分类
### 特征
- 并行性、分布性、机间的通信与同步性、可重构性

### 功能
- 进程管理：同步、通信、调度
- 存储器管理：地址变换机构、访问冲突仲裁机构、数据一致性机构
- 文件管理：集中式、分散式、分布式
- 系统重构

### 类型
- 主从式：易于实现、资源利用率低、安全性较差
- 独立监督式：自主性强、可靠性高、实现复杂、存储空间开销大、处理机负载不平衡
- 浮动监督式：高灵活性、高可靠性、负载均衡、实现复杂

## 进程同步
### 集中式与分布式同步方式
- 中心同步实体
  - 具有唯一的名字，且为彼此必须同步的所有进程知道
  - 在任何时刻，任何一个同步进程都可以访问该实体

- 集中式同步机构

- 集中式同步算法
  - 多个进程需要进行同步时仅由中心控制结点做出判定
  - 判定所需的全部信息集中在中心控制结点
  - 可靠性差、易形成瓶颈

- 分布式同步算法
  - 所有结点具有相同信息，且仅基于本地信息做判断
  - 为做出最后的判定，所有节点担负相同的责任
  - 为做出最后的判定，所有节点要付出同样的工作量
  - 一个结点故障通常不会引发系统的崩溃

- 中心进程方式：请求、回答、释放

### 自旋锁(Spin Lock)
- 引入：对总线资源的竞争
- 实现互斥的方法：在总线上设置一个自旋锁，请求到的进程才可使用总线
- 用自旋锁保护的临界区应比较短
- 类型：普通自旋锁、读写自旋锁、大读者自旋锁

### 读-拷贝-修改锁（Read-Copy-Update）
- RCU将要写的文件复制后仅修改副本，在适当的时候写回
- 垃圾收集器、回调(callback)机制、写延迟期(grace period)
- 优点：进程不会被阻塞；无需设置同步机构，但写者需要开销

### 二进制指数补偿算法
- 在测试锁后，每次等待的时间按2的指数增加

### 待锁CPU等待队列机构
- 在每个CPU私有高速缓存中存放一个锁，并在临界资源处记录待锁CPU的清单

### 定序机构
- 时间邮戳定序机构
(Timestamp Ordering Mechanism)
  - 系统中应具有唯一的、由单一物理时钟驱动的物理时钟体系，确保各处理机时钟间的严格同步
  - 对所有的特殊事件加上时间戳
  - 对每一种特殊事件使用特定时间戳
  - 根据事件上的时间邮戳，定义所有事件的全序

- 事件计数(Event Counts)同步机构：E、V、await、advance、read

- 面包房算法