---
title: 多处理机操作系统
markmap:
  colorFreezeLevel: 3
---

# 多处理机操作系统
## 多处理机系统
### 引入
- CPU时钟频率问题
- 增加系统的吞吐量
- 节省投资
- 提高系统可靠性

### 类型
- 紧密耦合MPS和松散耦合MPS
- 对称多处理器系统SMPS和非对称多处理器系统ASMPS

## 多处理机系统的结构
### 统一内存访问UMA
- 基于单总线的SMP结构
- 使用多层总线的SMP结构
- 使用单级交叉开关的系统结构
  - 交叉开关是$N\times N$的阵列，同时只能接通N个结点
  - 每个存储器模块（列）同时只允许一个CPU结点访问，但一个CPU（行）可以访问
  多个存储器结点
  - 交叉开关的成本为$N^2$
- 使用多级交换网络的系统结构

### 非统一内存访问NUMA
- 本地存储器、群内共享存储器、全局共享存储器或其他节点存储器
- CC-NUMA、NC-NUMA
- 远程内存访问由于访问远地内存的延时远远超过本地内存，
当CPU数量增加时，系统性能无法线性增加

## 多处理机操作系统的特征与分类
### 特征
- 并行性、分布性、机间的通信与同步性、可重构性

### 功能
- 进程管理：同步、通信、调度
- 存储器管理：地址变换机构、访问冲突仲裁机构、数据一致性机构
- 文件管理：集中式、分散式、分布式
- 系统重构

### 类型
- 主从式：易于实现、资源利用率低、安全性较差
- 独立监督式：自主性强、可靠性高、实现复杂、存储空间开销大、处理机负载不平衡
- 浮动监督式：高灵活性、高可靠性、负载均衡、实现复杂

## 进程同步
### 集中式与分布式同步方式
- 中心同步实体
  - 具有唯一的名字，且为彼此必须同步的所有进程知道
  - 在任何时刻，任何一个同步进程都可以访问该实体

- 集中式同步机构

- 集中式同步算法
  - 多个进程需要进行同步时仅由中心控制结点做出判定
  - 判定所需的全部信息集中在中心控制结点
  - 可靠性差、易形成瓶颈

- 分布式同步算法
  - 所有结点具有相同信息，且仅基于本地信息做判断
  - 为做出最后的判定，所有节点担负相同的责任
  - 为做出最后的判定，所有节点要付出同样的工作量
  - 一个结点故障通常不会引发系统的崩溃

- 中心进程方式：请求、回答、释放

### 自旋锁(Spin Lock)
- 引入：对总线资源的竞争
- 实现互斥的方法：在总线上设置一个自旋锁，请求到的进程才可使用总线
- 用自旋锁保护的临界区应比较短
- 类型：普通自旋锁、读写自旋锁、大读者自旋锁

### 读-拷贝-修改锁（Read-Copy-Update）
- RCU将要写的文件复制后仅修改副本，在适当的时候写回
- 垃圾收集器、回调(callback)机制、写延迟期(grace period)
- 优点：进程不会被阻塞；无需设置同步机构，但写者需要开销

### 二进制指数补偿算法
- 在测试锁后，每次等待的时间按2的指数增加

### 待锁CPU等待队列机构
- 在每个CPU私有高速缓存中存放一个锁，并在临界资源处记录待锁CPU的清单

### 定序机构
- 时间邮戳定序机构
(Timestamp Ordering Mechanism)
  - 系统中应具有唯一的、由单一物理时钟驱动的物理时钟体系，确保各处理机时钟间的严格同步
  - 对所有的特殊事件加上时间戳
  - 对每一种特殊事件使用特定时间戳
  - 根据事件上的时间邮戳，定义所有事件的全序

- 事件计数(Event Counts)同步机构：E、V、await、advance、read

- 面包房算法

- 令牌环算法

## 多处理机的进程调度
### 评价调度性能的若干因素
- 任务流时间：完成任务所需要的时间
- 调度流时间：系统中所有处理机上任务流时间的总和
- 平均流：调度流时间除以任务数
- 处理机利用率：该处理机上任务流之和除以最大有效时间单位
- 加速比：各处理机忙时间之和（单机工作时间）除以并行工作时间
（第一个任务开始到最后一个任务结束所用的时间）
- 吞吐率：单位时间内系统完成的任务数

### 进程分配方式
- SMPS的进程分配方式
  - 静态分配：进程始终在同一个处理器执行
  - 动态分配：消除了忙闲不均
- ASMPS的进程分配方式

### 进程（线程）调度方式
- 自调度方式
  - 类似单处理机系统调度
  - 可沿用单处理机方式；不会出现忙闲不均
  - 瓶颈问题；低效性；线程切换频繁
- 成组调度方式
  - 面向所有应用程序平均分配处理器时间
  - 面向所有线程平均分配处理器时间
- 专用处理机分配方式：用于处理机数量多的系统
- 动态调度：空闲则分配、新作业绝对优先、保持等待、释放即分配

### 死锁
- 类型：资源死锁、通信死锁
- 检测和解除：集中式检测、分布式检测

## 网络操作系统
### 网络及其体系结构
- 计算机网络的组成：通信子网、资源子网、网络协议
- 网络协议：语义、语法、时序
- 互联网协议IPv4和IPv6
- 传输层协议TCP和UDP
- 网络体系结构：物理层、数据链路层、网络层、传输层、会晤层、表示层、应用层

### 网络操作系统及其分类
- 特征：硬件独立性、接口一致性、资源透明性、系统可靠性、执行并行性
- 分类：
  - 主从模式
  - 对等模式(peer2peer model)
  - 工作站/服务器模式(Workstation/Server model)
  - 客户/服务器模式(Client/Server model)
  - 浏览器/服务器模式(Browser/Server model)

### 网络操作系统的功能
- 数据通信：连接的建立与拆除、报文的分解与组装、
传输控制、流量控制、差错控制
- 应用互操作：信息互通、信息互用
- 网络管理
  - 目标：网络的可用性、运行质量、资源利用率、数据安全性、社会和经济效益
  - 功能：配置、故障、性能、安全、计费

## 分布式文件系统(DFS)
### 特征
- 分布性：地理位置、功能、资源、控制
- 透明性：系统资源被所有计算机共享
- 同一性：系统中若干台计算机可以互相协作来完成一个共同的任务
- 全局性：系统具备一个全局性的进程通信机制

### 优点
- 计算能力强、易于实现共享、方便通信、可靠性高、可扩充性好
- 缺点：可用软件不足、通信网络信息丢失、数据保密安全问题

### 功能
- 通信管理功能、资源管理功能、进程管理功能

### 实现方式和基本要求
- 共享文件系统方式、共享磁盘方式
- 透明性、高性能和高可靠性、容错性、安全性、一致性

### 命名及共享语义
#### 命名
- 结合主机名和本地名对文件命名，保证整个系统范围的一致性
- 将若干台服务器中的远程目录，加载到客户机的本地目录中
- 全局统一命名

#### 共享语义
- UNIX语义：文件上每一个操作对所有进程都是瞬间可见
- 会话语义：文件关闭之前所有改动对其进程都是不可见的
- 不允许更新文件：不能进行更改，只能简单进行共享和复制
- 事务处理：所有改动以原子操作的方式（顺序）发生

#### 租赁协议

### 远程文件的访问和缓存
- 缓存的粒度和位置
- 缓存的更新：直接写、延迟写、驱逐时写、周期性写、关闭时写
- 数据一致性

### 容错
- 无状态服务和有状态服务：是否在提供服务时缓存的客户机信息
- 容错性：可恢复性、坚定性、可用性
- 可用性与文件复制
