---
title: 虚拟存储器
markmap:
  colorFreezeLevel: 3
---

# 虚拟存储器
## 常规存储管理方式的特征
- 一次性、驻留性

## 局部性原理
- 时间局限性：某条被执行过的指令不久后可能会再次执行
- 空间局限性：某个存储单元被访问后，附近的存储单元也将被访问

## 定义和特征
- 虚拟存储器：具有请求调入和置换功能，能从逻辑上对内存容量扩充的存储器系统
- 多次性：作业开始运行时允许程序和数据分多次调入内存
- 对换性：作业运行时会进行换入换出，而非全都常驻内存
- 虚拟性：从逻辑上扩充容量

## 请求分页存储管理方式
### 硬件支持
- 请求页表机制：页号、物理块号，状态位P，访问字段A，修改位M，外存地址
- 缺页中断机构
- 地址变换机构

### 内存分配
#### 最小物理块数
- 保证进程正常运行所需的最小物理块数

#### 内存分配策略
- 固定分配局部置换
- 可变分配全局置换
- 可变分配局部置换

#### 物理块分配算法
- 平均分配算法
- 按比例分配算法
- 考虑优先权的分配算法

#### 页面调入策略
- 何时调页：预调页策略、请求调页策略
- 从何处调页：
    - 拥有足够对换区时，从对换区调入
    - 缺少对换区空间时，不会被修改的文件
    从文件区调入，可能被修改的在对换区对换
    - UNIX方式
- 页面调入过程
- 缺页率：页面大小、进程所分配物理块数、页面置换算法、程序固有特性

## 页面置换算法
### 最佳置换算法(Optimal)
- 将未来最迟被使用的页面换出

### 先进先出页面置换算法(FIFO)
- 根据滞留时间，将最久的页面换出

### LRU（Least Recently Used）置换算法
- 将最近最久未使用的页面换出

### 最少使用(Least Frequently Used, LFU)置换算法
- 将最近最少被使用的页面换出

### Clock置换算法(NRU,最近未用算法)
- 简单Clock置换算法：仅用一个标志位标志页面是否在最近被使用
- 改进Clock置换算法：同时使用访问位A和修改位M组合判断

## 页面缓冲算法(PBA)
- 影响页面对换效率的因素：页面置换算法、写回磁盘的频率、读入内存的频率
- PBA：空闲页面链表、修改页面链表

## 访问内存的有效时间
- 被访问页在内存中，且其对应页表项在快表中：快表命中，访问访问内存一次、快表一次
- 被访问页在内存中，且其对应页表项不在快表中：访问内存两次、快表两次
- 被访问页不在内存中：缺页处理一次，访问内存两次、快表两次

## 抖动与工作集
- 多道程序度和处理机利用率：随着多道程序度增加，处理机利用率先增后减
- 抖动：由于进程物理块分配过少而频繁出现缺页，使得处理机利用率急剧下降
- 工作集：
  - 某段时间间隔内进程要访问的页面集合
  - 进程在时间间隔$(t-\Delta,t)$中引用页面的集合
  - 窗口尺寸
- 抖动的预防方法
  - 采取局部置换策略
  - 把工作集算法融入到处理机调度中
  - 利用“L=S”准则调节缺页率：L为缺页平均时间，S为平均缺页服务时间
  - 选择暂停的进程

## 请求分段存储管理方式
### 硬件支持
- 请求段表机制：存取方式、访问字段、修改位、存在位、增补位、外存始址
- 缺段中断机构
- 地址变换机构

### 分段的共享与保护
- 共享段表：共享进程计数count、存取控制字段、段号
- 共享段的分配与回收
- 分段保护
  - 越界检查
  - 存取控制检查：只读、只执行、读/写
  - 环保护机构：程序可以访问相同或较低环的数据，可以调用相同或较高环的服务

